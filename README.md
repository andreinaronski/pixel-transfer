# Transfer
Test task for Pioner Pixel

# Запуск
Приложение может быть замущено как с помощью запуска jar файла на локальной машине, так и в контейнерах Docker с помощью Docker-compose.

## Запуск на локальной машине
Для этого необходимо выполнить следующие шаги:
 1. Установить JDK 17
 2. Установить Postgres и Redis. Могут быть запущены в контейнерах Docker
 3. В Postgres создать базу "transfer"
 4. Склонировать в пустую папку репозиторий с GitHub: <br>
   - `git clone https://github.com/andreinaronski/pixel-transfer.git`
 5. Необходимо из папки с кодом выполнить следующие комманды:
   - `mvn clean install -DskipTests` - для компиляции кода и сборки jar файла
   - `java -jar target/transfer-0.0.1.jar` - для запуска приложения
   Во время запуска приложения выполнятся скрипты Liquibase. В базе будут доступны несколько юзеров.

## Запуск в контейнерах Docker
Для этого необходимо выполнить следующие шаги:
 1. Склонировать в пустую папку репозиторий с GitHub. <br>
    - `git clone https://github.com/andreinaronski/pixel-transfer.git`
 2. Выпонить комманду из папки с кодом: <br>
    - `docker-compose up --build` 
    Скачаются все необходимые докер образы, скомпилируется код, соберется jar и приложение запустится в контейнере.<br> 
    Также запустятся Postgres и Redis  каждый в своем контейнере. Для удобства работы с Redis на порту '5540' запустится Redis Insight. Он будет доступен по урлу 'http://localhost:5540'

# Описание приложения
После старта приложения в базу с помощью Liquibase добавляются 3 пользователя с аккаунтами, телефонами и email. <br>
При получении пользователя по его id результат попадает в Redis кеш, у которого TTL выставлен в 1 минуту. <br>
Каждые 30 сек запускается джоба, которая увеличивает всем пользователям баланс на 10%, но не более чем 207% от начальной суммы. После обновления пользователя результаты поиска пользователи и пользователи удаляются из кеша. <br>
Для удобства пользования и отслеживания API работает Swagger по урлу `http://localhost:8080/swagger-ui/index.html#` <br>
Для мониторинга Redis работает Redis Insight по урлу http://localhost:5540/. При первом запуске необходимо добавить базу Redis. Для этого в качестве Connection Url указываем `redis://default@redis:6379` <br>
Для выполнения запросов к API необходимо сначала аторизоваться по пути `/api/v1/auth/login` и получить token, использовав email в качестве login и значение `pass` в качестве пароля. Пароли в базе шифруются <br>
Токен необходимо передавать с каждым запросом к API в заголовке запроса по имени `Authorization` и значением `Bearer {{token}}` <br>
Время жизни токена указывается параметром `token.expiration-time` в `application.yml` <br>